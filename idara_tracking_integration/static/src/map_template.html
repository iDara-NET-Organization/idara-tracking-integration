<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idara Tracking - Device Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        #header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
        }
        #header img {
            height: 40px;
            margin-right: 15px;
        }
        #header h1 {
            margin: 0;
            font-size: 24px;
        }
        #map {
            height: calc(100vh - 70px);
            width: 100%;
        }
        .device-popup {
            min-width: 200px;
        }
        .device-popup h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .device-popup p {
            margin: 5px 0;
            font-size: 13px;
        }
        .status-online { color: #28a745; }
        .status-offline { color: #dc3545; }
        .status-moving { color: #007bff; }
        .status-idle { color: #ffc107; }
    </style>
</head>
<body>
    <div id="header">
        <img src="data:image/png;base64,LOGO_BASE64_HERE" alt="Idara Tracking">
        <h1>Live Device Tracking</h1>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize map
        const map = L.map('map').setView([24.7136, 46.6753], 6); // Default: Riyadh, Saudi Arabia

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors',
            maxZoom: 19
        }).addTo(map);

        // Custom icon for devices
        const deviceIcon = L.icon({
            iconUrl: 'data:image/svg+xml;base64,' + btoa(`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32" height="32">
                    <path fill="#dc3545" d="M12 0C7.31 0 3.5 3.81 3.5 8.5C3.5 14.88 12 24 12 24s8.5-9.12 8.5-15.5C20.5 3.81 16.69 0 12 0zm0 11.5c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"/>
                </svg>
            `),
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });

        // Example devices data - Replace with your API data
        const devices = [
            {
                id: "DEVICE001",
                name: "Vehicle 1",
                latitude: 24.7136,
                longitude: 46.6753,
                speed: 45.5,
                status: "moving",
                driver: "Ahmad",
                address: "Riyadh, Saudi Arabia"
            },
            {
                id: "DEVICE002",
                name: "Vehicle 2",
                latitude: 21.4225,
                longitude: 39.8262,
                speed: 0,
                status: "idle",
                driver: "Mohammed",
                address: "Jeddah, Saudi Arabia"
            },
            {
                id: "DEVICE003",
                name: "Vehicle 3",
                latitude: 26.4207,
                longitude: 50.0888,
                speed: 62.3,
                status: "online",
                driver: "Khalid",
                address: "Dammam, Saudi Arabia"
            }
        ];

        // Add devices to map
        devices.forEach(device => {
            const marker = L.marker([device.latitude, device.longitude], {
                icon: deviceIcon,
                title: device.name
            }).addTo(map);

            const statusClass = `status-${device.status}`;
            const popupContent = `
                <div class="device-popup">
                    <h3>${device.name}</h3>
                    <p><strong>Device ID:</strong> ${device.id}</p>
                    <p><strong>Status:</strong> <span class="${statusClass}">${device.status.toUpperCase()}</span></p>
                    <p><strong>Speed:</strong> ${device.speed} km/h</p>
                    <p><strong>Driver:</strong> ${device.driver}</p>
                    <p><strong>Location:</strong> ${device.address}</p>
                    <p><strong>Coordinates:</strong> ${device.latitude.toFixed(4)}, ${device.longitude.toFixed(4)}</p>
                </div>
            `;

            marker.bindPopup(popupContent);
        });

        // Fit map to show all markers
        if (devices.length > 0) {
            const bounds = L.latLngBounds(devices.map(d => [d.latitude, d.longitude]));
            map.fitBounds(bounds, { padding: [50, 50] });
        }

        // Auto-refresh every 30 seconds (optional)
        setInterval(() => {
            console.log('Refreshing device locations...');
            // Add your API call here to fetch updated positions
        }, 30000);
    </script>
</body>
</html>
