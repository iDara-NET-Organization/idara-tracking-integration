<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="tracking_map_template" name="Tracking Map">
        <t t-set="head">
            <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
            <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
            <style>
                body { margin: 0; padding: 0; overflow: hidden; }
                #header {
                    background: linear-gradient(135deg, #dc3545, #c82333);
                    color: white;
                    padding: 15px 20px;
                    height: 70px;
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                }
                #map { height: calc(100vh - 70px); width: 100%; }
                .device-count { background: #28a745; color: white; padding: 8px 15px; border-radius: 15px; font-weight: bold; }
            </style>
        </t>
        
        <t t-call="web.layout">
            <t t-set="head_website" t-value="head"/>
            
            <div id="header">
                <div>
                    <img src="/idara_tracking_integration/static/src/img/logo.png" style="height:45px;margin-right:15px;"/>
                    <span style="font-size:22px;">üó∫Ô∏è Live Device Tracking</span>
                </div>
                <span class="device-count" id="device-count"><t t-esc="device_count or 0"/> Devices</span>
            </div>
            
            <div id="map"></div>
            
            <script type="text/javascript">
                var devices = <t t-raw="devices"/>;
                var map, markers = {};
                
                function initMap() {
                    console.log('Loading map...');
                    map = L.map('map').setView([24.7136, 46.6753], 6);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© OpenStreetMap'
                    }).addTo(map);
                    
                    console.log('Adding', devices.length, 'devices');
                    devices.forEach(function(d) {
                        var lat = parseFloat(d.latitude);
                        var lng = parseFloat(d.longitude);
                        if (lat &amp;&amp; lng) {
                            var m = L.marker([lat, lng]).addTo(map);
                            m.bindPopup('<b>' + (d.name || 'Device') + '</b>');
                            markers[d.id] = m;
                        }
                    });
                    
                    console.log('Map loaded!');
                }
                
                window.addEventListener('load', initMap);
            </script>
        </t>
    </template>
</odoo>
